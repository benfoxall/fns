<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>write</title>
  </head>
  <body>
    <script src="recast.js"></script>
    <script type="text/javascript">

      const code = `const button = document.querySelector('button')

      button.addEventListener('click', () => {
        console.log("Button was clicked")

        test()
      })

      function test() {
        document.body.style.background = \`hsl(${~~(Math.random()*360)}, 50%, 50%)\`
      }

      function nope() {
        console.log("NOPE")
      }
`
const b = recast.types.builders
var ast = recast.parse(code)

let count = 1
recast.types.visit(ast, {

  visitFunction: function(path) {
    const node = path.node

    const track = b.expressionStatement(b.callExpression(
      b.identifier('___'),
      [b.numericLiteral(count++)]
    ))

    path.get("body", "body").unshift(track)

    this.traverse(path)
  }
})


var output = recast.print(ast).code;
console.log(`const ___ = (i) => {
  console.log('track', i)
};
${output}
`)

    </script>

   </body>
</html>
